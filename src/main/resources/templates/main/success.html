<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" href="../../static/css/success.css" th:href="@{/css/success.css}">
    <title>Success!</title>
</head>
<body>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>



<!--insert banner?-->
<div id="top-banner">
    <br>
    <div>
    <img src="../../static/images/hfn-logo-meditating.png" th:src="@{/images/hfn-logo-meditating.png}" style="height: 300px; text-align: center">
    </div>
    <div id="top-banner-text">
        A Voice that Cares
    </div>
</div>
<br>
<br>

<div id="toggle" style="text-align: center">
    <label class="switch">
        <input type="checkbox" id="toggle-switch" onclick="toggler()">
        <span class="slider round"></span>
    </label>
    <p id="status">Status: Offline</p>
</div>



<div style="text-align: center;">
    <div id="calls_display" style="text-align: center;">
        <table style="text-align: center" class="table">
            <thead>
            <tr>
                <th>Call ID</th>
                <th>Call description</th>
                <th>Call Agent name</th>
                <th>Caller name</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="call : ${calls}">
                <td th:text="${call.id}"></td>
                <td th:text="${call.description}"></td>
                <td th:text="${call.agent.name}"></td>
                <td th:text="${call.caller.name}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div th:if="${agent.role} == 'manager'">
        <a href="/m/display">View All Agent Details</a>
    </div>
</div>
</body>
</html>
<script th:inline="javascript">

    let agentStatus = /*[[${agent.status}]]*/ null
    console.log(agentStatus);


    if (agentStatus === 'online') {
        document.getElementById("toggle-switch").checked = true;
        document.getElementById("status").innerHTML = "Status: Online";
    } else {
        document.getElementById("toggle-switch").checked = false;
        document.getElementById("status").innerHTML = "Status: Offline";
    }

    function toggler() {
        let checkboxVal = document.getElementById("toggle-switch");
        if (checkboxVal.checked === true) {
            document.getElementById("status").innerHTML = "Status: Online";
            let xhttp = new XMLHttpRequest(); //creating ajax req
            //console.log(document.getElementById("id"));
            xhttp.open("GET","http://localhost:8082/mark/online", true);
            xhttp.send();
        } else {
            document.getElementById("status").innerHTML = "Status: Offline";
            let xhttp = new XMLHttpRequest();
            xhttp.open("GET","http://localhost:8082/mark/offline",true);
            xhttp.send();
        }
    }

</script>